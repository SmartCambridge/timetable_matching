<html>

<head>
    <title>Trip and Journey viewer</title>

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
          integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
          integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
          crossorigin=""></script>

    <style>

    html: {
        height: 100%
        width: 100%;
    }

    .results {
        height: 100%;
        width: 100%;
    }

    .data-table {
        height: 50%;
        width: 100%;
        overflow: scroll;
    }

    .map {
        height: 50%;
        width: 100%;

    }


    table {
      border-collapse: collapse;
      border: 3px solid black;
      font-family: 'helvetica neue', helvetica, arial, sans-serif;
      font-size: 0.7rem;
      background-color: #fff;
    }

    th {
      letter-spacing: 2px;
      padding: 0.2rem;
    }

    td {
      letter-spacing: 1px;
      padding: 0.2rem;
    }

    tbody td {
      text-align: left;
    }

    tr {
      border-top: 1px solid black;
      border-bottom: 1px solid black;
    }

    tbody tr:nth-child(even) {
        background-color: #eee;
    }

    tbody tr.mismatch {
        background-color: #fee;
    }

    tbody tr.mismatch:nth-child(even)  {
        background-color: #edd;
    }

    </style>

    <script type="text/javascript" src="rows-2018-09-08.js"></script>

    <script type="text/javascript">

        function add_heading(row, text) {
            cell = document.createElement('th');
            cell.appendChild(document.createTextNode(text))
            row.appendChild(cell)
        }

        function add_data(row, text) {
            cell = document.createElement('td');
            cell.appendChild(document.createTextNode(text))
            row.appendChild(cell)
        }

        function display_trip(row_num) {
            alert("Display trip " + row_num);
        }

        function display_journey(row_num) {
            alert("Display journey " + row_num);
        }


        function init() {

            map = L.map('map');

            function display_trip(row_num) {
                alert("Display trip " + row_num);
            }

            function display_journey(row_num) {
                alert("Display journey " + row_num);
            }


            var table = document.createElement('table');

            var trow = document.createElement('tr');
            add_heading(trow, '');
            add_heading(trow, 'Type');
            add_heading(trow, 'Time');
            add_heading(trow, 'From');
            add_heading(trow, 'To');
            add_heading(trow, 'Trip-Line');
            add_heading(trow, 'Trip-Operator');
            add_heading(trow, 'Trip-Direction');
            add_heading(trow, 'Trip-Vehicle');
            add_heading(trow, 'Trip-Positions');
            add_heading(trow, '');
            add_heading(trow, '');
            add_heading(trow, '');
            add_heading(trow, 'Service-Line');
            add_heading(trow, 'Service-Operator');
            add_heading(trow, 'Service-Direction');

            var thead = document.createElement('thead');
            thead.appendChild(trow);
            table.appendChild(thead);

            var counter = 1;

            var tbody = document.createElement('tbody');

            data.rows.forEach(function(row) {
                var trow = document.createElement('tr');
                if (row.type !== '1-1') {
                    trow.classList.add('mismatch');
                }

                add_heading(trow, counter);

                add_data(trow, row.type);
                add_data(trow, row.time);
                add_data(trow, row.origin);
                add_data(trow, row.destination);
                if (row.trip) {
                    add_data(trow, row.trip.LineRef);
                    add_data(trow, row.trip.OperatorRef);
                    add_data(trow, row.trip.DirectionRef);
                    add_data(trow, row.trip.VehicleRef);
                    add_data(trow, row.trip.positions.length);
                    var a = document.createElement('a');
                    a.setAttribute('href', '#');
                    a.onclick = function(c) {
                        return function() {
                            display_trip(c);
                            return false;
                        };
                    }(counter);
                    a.appendChild(document.createTextNode('Show'));
                    cell = document.createElement('td');
                    cell.appendChild(a);
                    trow.appendChild(cell);
                }
                else {
                    add_data(trow, '');
                    add_data(trow, '');
                    add_data(trow, '');
                    add_data(trow, '');
                    add_data(trow, '');
                    add_data(trow, '');
                }
                add_data(trow, row.separator);
                if (row.journey) {
                    var a = document.createElement('a');
                    a.setAttribute('href', '#');
                    a.onclick = function(c) {
                        return function() {
                            display_journey(c);
                            return false;
                        };
                    }(counter);
                    a.appendChild(document.createTextNode('Show'));
                    cell = document.createElement('td');
                    cell.appendChild(a);
                    trow.appendChild(cell);
                    add_data(trow, row.journey.Service.LineName);
                    add_data(trow, row.journey.Service.OperatorCode);
                    add_data(trow, row.journey.Direction);
                }
                else {
                    add_data(trow, '');
                    add_data(trow, '');
                    add_data(trow, '');
                    add_data(trow, '');
                }

                tbody.appendChild(trow);

                counter += 1;

            });

            table.appendChild(tbody);

            var results = document.getElementById('data-table');
            results.appendChild(table);

            var osm = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
               attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
               maxZoom: 20
            });
            map.addLayer(osm);
            var cambridge = L.latLng(52.20038, 0.1197);
            map.setView(cambridge, 14);

        }

    </script>

</head>

<body onload="init()">

    <div class="results">
        <div id="data-table" class="data-table"></div>
        <div id="map" class="map"></div>
    </div>

</body>

</html>